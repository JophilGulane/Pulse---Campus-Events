{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load auth_helpers %}

{% block title %}Leaderboard - Pulse{% endblock %}

{% block head_extra %}
<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.8;
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    opacity: 0;
  }

  .animate-slideUp {
    animation: slideUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    opacity: 0;
  }

  .delay-200 {
    animation-delay: 0.2s;
  }

  .delay-300 {
    animation-delay: 0.3s;
  }

  .delay-400 {
    animation-delay: 0.4s;
  }

  .delay-500 {
    animation-delay: 0.5s;
  }

  .delay-600 {
    animation-delay: 0.6s;
  }

  .premium-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .premium-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.6s;
  }

  .premium-card:hover::before {
    left: 100%;
  }

  .premium-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
  }

  .glass {
    background: rgba(20, 27, 77, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(0, 115, 230, 0.2);
  }

  .gradient-text {
    background: linear-gradient(135deg, #0073E6 0%, #7C00E6 50%, #FF7200 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }

    100% {
      background-position: 1000px 0;
    }
  }

  .rank-1 {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    animation: glow 2s ease-in-out infinite;
  }

  @keyframes glow {

    0%,
    100% {
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    }

    50% {
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    }
  }

  .rank-2 {
    background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
    box-shadow: 0 0 20px rgba(192, 192, 192, 0.4);
  }

  .rank-3 {
    background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
    box-shadow: 0 0 20px rgba(205, 127, 50, 0.4);
  }

  .podium-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .podium-card:hover {
    transform: translateY(-10px) scale(1.05);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
  }

  .table-row {
    transition: all 0.2s ease;
  }

  .table-row:hover {
    transform: translateX(5px);
    box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-pulse-navy overflow-x-hidden">
  <!-- Mobile-First Compact Header -->
  <div class="sticky top-0 z-40 bg-pulse-navyLight/95 backdrop-blur-lg border-b border-pulse-blue/20 lg:hidden">
    <div class="px-3 py-2">
      <div class="flex items-center justify-center">
        <div class="text-center">
          <p class="text-[10px] text-text-muted uppercase tracking-wide mb-0.5">{{ now|date:"l, M d"|upper }}</p>
          <h1 class="text-xl font-bold text-white">Leaderboard</h1>
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop Header -->
  <div class="hidden lg:block max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="text-center mb-8 animate-fadeIn">
      <h1 class="text-4xl md:text-5xl font-display font-bold pulse-gradient-text mb-1">
        Leaderboard
      </h1>
      <p class="text-sm md:text-base text-text-secondary max-w-2xl mx-auto">
        Compete for the top spot. Switch organizations to see rankings by org, or view the global board.
      </p>

      {% if user.is_authenticated and user_profile %}
      <div
        class="mt-5 inline-flex flex-col sm:flex-row items-center gap-3 px-6 py-3 glass rounded-pulse shadow-pulse border border-pulse-blue/30 animate-scale-in delay-200 premium-card">
        <div class="flex items-center gap-2">
          <svg class="w-6 h-6 text-pulse-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span class="text-text-secondary font-medium">Your Rank:</span>
          <span class="ml-1 text-2xl font-bold text-pulse-blue">#{{ user_rank }}</span>
        </div>
        <span class="hidden sm:inline text-text-muted">â€¢</span>
        <div class="flex items-center gap-2">
          <span class="text-text-secondary font-medium">Points:</span>
          <span class="text-xl font-bold text-pulse-purple">
            {% if selected_org %}
            {{ user_profile.org_points|default:0|intcomma }}
            {% else %}
            {{ user_profile.total_points|intcomma }}
            {% endif %}
          </span>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="max-w-4xl mx-auto px-3 sm:px-4 lg:px-8 py-3 sm:py-4 lg:py-8">
    <!-- Organization Filter -->
    <div class="mb-4 sm:mb-6 lg:mb-8 animate-fadeIn delay-200">
      <form method="get" class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 max-w-2xl mx-auto">
        <label for="leaderboard-organization" class="hidden sm:block text-xs sm:text-sm font-medium text-text-secondary whitespace-nowrap">
          Organization
        </label>
        <select id="leaderboard-organization" name="organization"
          class="flex-1 px-3 sm:px-4 py-2.5 sm:py-2 border border-pulse-blue/30 rounded-pulse focus:ring-2 focus:ring-pulse-blue focus:border-pulse-blue text-xs sm:text-sm bg-pulse-navyLighter text-white placeholder:text-text-muted">
          <option value="">All organizations (global)</option>
          {% for org in organizations %}
          <option value="{{ org.id }}" {% if selected_org_id|equals:org.id %}selected{% endif %}>
            {{ org.name }}
          </option>
          {% endfor %}
        </select>
        <button type="submit"
          class="px-4 sm:px-5 py-2.5 sm:py-2 bg-pulse-gradient text-white rounded-pulse text-xs sm:text-sm font-medium hover:opacity-90 transition-all shadow-pulse-sm whitespace-nowrap flex items-center justify-center gap-1.5 sm:gap-2">
          <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <span>Apply</span>
        </button>
      </form>
    </div>

    <!-- Top 3 Podium (Desktop Only) -->
    {% if top_1 or top_2 or top_3 %}
    <div class="hidden lg:block mb-12 animate-fadeIn delay-300">
      <h2 class="text-2xl font-bold text-white mb-6 text-center">Top Performers</h2>
      <div class="grid grid-cols-3 gap-6 max-w-4xl mx-auto">
        <!-- 2nd Place -->
        {% if top_2 %}
        <div class="order-2 md:order-1 flex flex-col items-center animate-slideUp delay-400">
          <div class="relative w-full">
            <div class="podium-card glass bg-pulse-navyLight rounded-pulse-lg p-3 sm:p-4 lg:p-6 shadow-pulse border border-pulse-blue/20">
              <div class="flex flex-col items-center">
                <div class="w-12 h-12 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-full rank-2 flex items-center justify-center mb-2 sm:mb-3 lg:mb-4 shadow-pulse-sm bg-pulse-navyLighter">
                  <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-white">2</span>
                </div>
                {% if top_2.avatar %}
                <img src="{{ top_2.avatar.url }}" alt="{{ top_2.user|get_display_name }}"
                  class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-full object-cover border-2 sm:border-4 border-pulse-blue/50 shadow-pulse-sm mb-2 sm:mb-3 -mt-12 sm:-mt-14 lg:-mt-16">
                {% else %}
                <div
                  class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-full bg-pulse-gradient border-2 sm:border-4 border-pulse-blue/50 shadow-pulse-sm mb-2 sm:mb-3 -mt-12 sm:-mt-14 lg:-mt-16 flex items-center justify-center">
                  <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-white">{{ top_2.user|get_initials }}</span>
                </div>
                {% endif %}
                <h3 class="text-base sm:text-lg lg:text-xl font-bold text-white mb-0.5 sm:mb-1">{{ top_2.user|get_display_name|truncatewords:2 }}</h3>
                <p class="text-xs sm:text-sm text-text-muted mb-1 sm:mb-2">@{{ top_2.user.username|truncatechars:15 }}</p>
                <div class="flex items-center space-x-1 sm:space-x-2">
                  <svg class="w-4 h-4 sm:w-5 sm:h-5 text-pulse-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                  </svg>
                  <span class="text-lg sm:text-xl lg:text-2xl font-bold text-pulse-purple">
                    {% if selected_org %}
                    {{ top_2.org_points|default:0|intcomma }}
                    {% else %}
                    {{ top_2.total_points|intcomma }}
                    {% endif %}
                  </span>
                  <span class="text-xs sm:text-sm text-text-muted">pts</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- 1st Place -->
        {% if top_1 %}
        <div class="order-1 md:order-2 flex flex-col items-center animate-slideUp delay-300">
          <div class="relative w-full">
            <div
              class="podium-card glass bg-pulse-gradient rounded-pulse-lg p-3 sm:p-4 lg:p-6 shadow-pulse border-2 border-pulse-orange/50">
              <div class="flex flex-col items-center">
                <div
                  class="w-12 h-12 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-full rank-1 flex items-center justify-center mb-2 sm:mb-3 lg:mb-4 shadow-pulse bg-pulse-orange/20">
                  <svg class="w-6 h-6 sm:w-8 sm:h-8 lg:w-10 lg:h-10 text-pulse-orange" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                    </path>
                  </svg>
                </div>
                {% if top_1.avatar %}
                <img src="{{ top_1.avatar.url }}" alt="{{ top_1.user|get_display_name }}"
                  class="w-20 h-20 sm:w-24 sm:h-24 lg:w-28 lg:h-28 rounded-full object-cover border-2 sm:border-4 border-pulse-orange/70 shadow-pulse mb-2 sm:mb-3 -mt-16 sm:-mt-18 lg:-mt-20">
                {% else %}
                <div
                  class="w-20 h-20 sm:w-24 sm:h-24 lg:w-28 lg:h-28 rounded-full bg-pulse-gradient border-2 sm:border-4 border-pulse-orange/70 shadow-pulse mb-2 sm:mb-3 -mt-16 sm:-mt-18 lg:-mt-20 flex items-center justify-center">
                  <span class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white">{{ top_1.user|get_initials }}</span>
                </div>
                {% endif %}
                <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-white mb-0.5 sm:mb-1">{{ top_1.user|get_display_name|truncatewords:2 }}</h3>
                <p class="text-xs sm:text-sm text-text-secondary mb-1 sm:mb-2">@{{ top_1.user.username|truncatechars:15 }}</p>
                <div class="flex items-center space-x-1 sm:space-x-2">
                  <svg class="w-5 h-5 sm:w-6 sm:h-6 text-pulse-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                  </svg>
                  <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-pulse-orange">
                    {% if selected_org %}
                    {{ top_1.org_points|default:0|intcomma }}
                    {% else %}
                    {{ top_1.total_points|intcomma }}
                    {% endif %}
                  </span>
                  <span class="text-xs sm:text-sm text-text-muted">pts</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- 3rd Place -->
        {% if top_3 %}
        <div class="order-3 flex flex-col items-center animate-slideUp delay-500">
          <div class="relative w-full">
            <div class="podium-card glass bg-pulse-navyLight rounded-pulse-lg p-3 sm:p-4 lg:p-6 shadow-pulse border border-pulse-purple/20">
              <div class="flex flex-col items-center">
                <div class="w-12 h-12 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-full rank-3 flex items-center justify-center mb-2 sm:mb-3 lg:mb-4 shadow-pulse-sm bg-pulse-navyLighter">
                  <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-white">3</span>
                </div>
                {% if top_3.avatar %}
                <img src="{{ top_3.avatar.url }}" alt="{{ top_3.user|get_display_name }}"
                  class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-full object-cover border-2 sm:border-4 border-pulse-purple/50 shadow-pulse-sm mb-2 sm:mb-3 -mt-12 sm:-mt-14 lg:-mt-16">
                {% else %}
                <div
                  class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-full bg-pulse-gradient border-2 sm:border-4 border-pulse-purple/50 shadow-pulse-sm mb-2 sm:mb-3 -mt-12 sm:-mt-14 lg:-mt-16 flex items-center justify-center">
                  <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-white">{{ top_3.user|get_initials }}</span>
                </div>
                {% endif %}
                <h3 class="text-base sm:text-lg lg:text-xl font-bold text-white mb-0.5 sm:mb-1">{{ top_3.user|get_display_name|truncatewords:2 }}</h3>
                <p class="text-xs sm:text-sm text-text-muted mb-1 sm:mb-2">@{{ top_3.user.username|truncatechars:15 }}</p>
                <div class="flex items-center space-x-1 sm:space-x-2">
                  <svg class="w-4 h-4 sm:w-5 sm:h-5 text-pulse-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                  </svg>
                  <span class="text-lg sm:text-xl lg:text-2xl font-bold text-pulse-purple">
                    {% if selected_org %}
                    {{ top_3.org_points|default:0|intcomma }}
                    {% else %}
                    {{ top_3.total_points|intcomma }}
                    {% endif %}
                  </span>
                  <span class="text-xs sm:text-sm text-text-muted">pts</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Full Leaderboard List -->
    <!-- Mobile: Card Layout -->
    <div class="lg:hidden space-y-3 animate-fadeIn delay-600">
      {% for item in profiles_with_rank %}
      <div class="bg-pulse-navyLight rounded-pulse-lg shadow-pulse-sm p-3 sm:p-4 border border-pulse-blue/20 {% if item.is_current_user %}ring-2 ring-pulse-blue/50{% endif %}">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3 flex-1 min-w-0">
            <div class="flex-shrink-0">
              {% if item.rank <= 3 %}
              <div class="text-2xl sm:text-3xl">
                {% if item.rank == 1 %}ðŸ¥‡{% elif item.rank == 2 %}ðŸ¥ˆ{% elif item.rank == 3 %}ðŸ¥‰{% endif %}
              </div>
              <div class="text-xs sm:text-sm font-bold text-white text-center">#{{ item.rank }}</div>
              {% else %}
              <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-pulse-navyLighter flex items-center justify-center border border-pulse-blue/30">
                <span class="text-sm sm:text-base font-bold text-text-secondary">#{{ item.rank }}</span>
              </div>
              {% endif %}
            </div>
            {% if item.profile.avatar %}
            <img src="{{ item.profile.avatar.url }}"
              alt="{{ item.profile.user.get_full_name|default:item.profile.user.username }}"
              class="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-pulse-blue/30 flex-shrink-0">
            {% else %}
            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-pulse-gradient border-2 border-pulse-blue/30 flex items-center justify-center flex-shrink-0">
              <span class="text-white font-bold text-xs sm:text-sm">{{ item.profile.user|get_initials }}</span>
            </div>
            {% endif %}
            <div class="min-w-0 flex-1">
              <div class="text-sm sm:text-base font-semibold text-white truncate">
                {{ item.profile.user.get_full_name|default:item.profile.user.username|truncatechars:20 }}
                {% if item.is_current_user %}
                <span class="ml-1.5 px-1.5 sm:px-2 py-0.5 text-[10px] sm:text-xs bg-pulse-blue text-white rounded-pulse-full">You</span>
                {% endif %}
              </div>
              <div class="text-[10px] sm:text-xs text-text-muted truncate">@{{ item.profile.user.username|truncatechars:15 }}</div>
            </div>
          </div>
          <div class="flex-shrink-0 ml-3 text-right">
            <div class="text-base sm:text-lg font-bold text-pulse-purple">
              {% if selected_org %}
              {{ item.profile.org_points|default:0|intcomma }}
              {% else %}
              {{ item.profile.total_points|intcomma }}
              {% endif %}
            </div>
            <div class="text-[10px] sm:text-xs text-text-muted">pts</div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="bg-pulse-navyLight rounded-pulse-lg shadow-pulse-sm p-6 sm:p-8 border border-pulse-blue/20 text-center">
        <p class="text-text-muted text-sm sm:text-base">No users found on the leaderboard yet. Start attending events to earn points!</p>
      </div>
      {% endfor %}
    </div>

    <!-- Desktop: Table Layout -->
    <div class="hidden lg:block glass rounded-pulse-lg shadow-pulse overflow-hidden animate-fadeIn delay-600 premium-card">
      <div class="px-4 lg:px-6 py-3 lg:py-4 bg-pulse-gradient rounded-t-pulse-lg">
        <h2 class="text-xl lg:text-2xl font-bold text-white">Full Rankings</h2>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-pulse-navyLight">
            <tr>
              <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Rank</th>
              <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">User</th>
              <th class="px-4 lg:px-6 py-3 lg:py-4 text-right text-xs font-medium text-text-secondary uppercase tracking-wider">Points</th>
            </tr>
          </thead>
          <tbody class="bg-pulse-navy divide-y divide-pulse-blue/20">
            {% for item in profiles_with_rank %}
            <tr
              class="table-row {% if item.is_current_user %}bg-pulse-navyLighter border-l-4 border-pulse-blue{% else %}hover:bg-pulse-navyLighter{% endif %}">
              <td class="px-4 lg:px-6 py-3 lg:py-4 whitespace-nowrap">
                <div class="flex items-center">
                  {% if item.rank <= 3 %} <span class="text-xl lg:text-2xl">
                    {% if item.rank == 1 %}ðŸ¥‡{% elif item.rank == 2 %}ðŸ¥ˆ{% elif item.rank == 3 %}ðŸ¥‰{% endif %}
                    </span>
                    <span class="ml-2 text-base lg:text-lg font-bold text-white">#{{ item.rank }}</span>
                    {% else %}
                    <span class="text-base lg:text-lg font-semibold text-text-secondary">#{{ item.rank }}</span>
                    {% endif %}
                </div>
              </td>
              <td class="px-4 lg:px-6 py-3 lg:py-4 whitespace-nowrap">
                <div class="flex items-center">
                  {% if item.profile.avatar %}
                  <img src="{{ item.profile.avatar.url }}"
                    alt="{{ item.profile.user.get_full_name|default:item.profile.user.username }}"
                    class="w-10 h-10 rounded-full object-cover mr-3 border-2 border-pulse-blue/30">
                  {% else %}
                  <div
                    class="w-10 h-10 rounded-full bg-pulse-gradient mr-3 border-2 border-pulse-blue/30 flex items-center justify-center">
                    <span class="text-white font-bold text-sm">{{ item.profile.user|get_initials }}</span>
                  </div>
                  {% endif %}
                  <div class="min-w-0">
                    <div class="text-sm font-medium text-white truncate">
                      {{ item.profile.user.get_full_name|default:item.profile.user.username|truncatechars:20 }}
                      {% if item.is_current_user %}
                      <span class="ml-2 px-2 py-0.5 text-xs bg-pulse-blue text-white rounded-pulse-full">You</span>
                      {% endif %}
                    </div>
                    <div class="text-xs text-text-muted truncate">@{{ item.profile.user.username|truncatechars:15 }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 lg:px-6 py-3 lg:py-4 whitespace-nowrap text-right">
                <div class="flex items-center justify-end">
                  <span class="text-base lg:text-lg font-bold text-pulse-purple">
                    {% if selected_org %}
                    {{ item.profile.org_points|default:0|intcomma }}
                    {% else %}
                    {{ item.profile.total_points|intcomma }}
                    {% endif %}
                  </span>
                  <span class="ml-1 text-sm text-text-muted">pts</span>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" class="px-6 py-8 text-center text-text-muted">
                No users found on the leaderboard yet. Start attending events to earn points!
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if is_paginated %}
      <div class="px-4 lg:px-6 py-3 lg:py-4 bg-pulse-navyLight border-t border-pulse-blue/20 rounded-b-pulse-lg">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
          <div class="text-xs sm:text-sm text-text-secondary">
            Showing page <span class="font-medium">{{ page_obj.number }}</span> of <span class="font-medium">{{ page_obj.paginator.num_pages }}</span>
          </div>
          <div class="flex gap-2">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if selected_org_id %}&organization={{ selected_org_id }}{% endif %}"
              class="px-3 sm:px-4 py-2 bg-pulse-navyLighter border border-pulse-blue/30 rounded-pulse text-xs sm:text-sm font-medium text-white hover:bg-pulse-navyLighter/80 transition-colors">
              Previous
            </a>
            {% else %}
            <span
              class="px-3 sm:px-4 py-2 bg-pulse-navyLighter/50 border border-pulse-blue/20 rounded-pulse text-xs sm:text-sm font-medium text-text-muted cursor-not-allowed">
              Previous
            </span>
            {% endif %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if selected_org_id %}&organization={{ selected_org_id }}{% endif %}"
              class="px-3 sm:px-4 py-2 bg-pulse-navyLighter border border-pulse-blue/30 rounded-pulse text-xs sm:text-sm font-medium text-white hover:bg-pulse-navyLighter/80 transition-colors">
              Next
            </a>
            {% else %}
            <span
              class="px-3 sm:px-4 py-2 bg-pulse-navyLighter/50 border border-pulse-blue/20 rounded-pulse text-xs sm:text-sm font-medium text-text-muted cursor-not-allowed">
              Next
            </span>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Mobile Pagination -->
    {% if is_paginated %}
    <div class="lg:hidden mt-4 flex items-center justify-between gap-3">
      <div class="text-xs text-text-secondary">
        Page <span class="font-medium">{{ page_obj.number }}</span> of <span class="font-medium">{{ page_obj.paginator.num_pages }}</span>
      </div>
      <div class="flex gap-2">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if selected_org_id %}&organization={{ selected_org_id }}{% endif %}"
          class="px-3 py-2 bg-pulse-navyLighter border border-pulse-blue/30 rounded-pulse text-xs font-medium text-white hover:bg-pulse-navyLighter/80 transition-colors">
          Previous
        </a>
        {% else %}
        <span
          class="px-3 py-2 bg-pulse-navyLighter/50 border border-pulse-blue/20 rounded-pulse text-xs font-medium text-text-muted cursor-not-allowed">
          Previous
        </span>
        {% endif %}

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if selected_org_id %}&organization={{ selected_org_id }}{% endif %}"
          class="px-3 py-2 bg-pulse-navyLighter border border-pulse-blue/30 rounded-pulse text-xs font-medium text-white hover:bg-pulse-navyLighter/80 transition-colors">
          Next
        </a>
        {% else %}
        <span
          class="px-3 py-2 bg-pulse-navyLighter/50 border border-pulse-blue/20 rounded-pulse text-xs font-medium text-text-muted cursor-not-allowed">
          Next
        </span>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}